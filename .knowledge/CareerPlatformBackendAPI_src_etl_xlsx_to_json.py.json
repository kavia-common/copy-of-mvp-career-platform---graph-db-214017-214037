{"is_source_file": true, "format": "Python", "description": "Source code for a utility that converts Excel (.xlsx/.xls) spreadsheets into normalized JSON data structures for use in an ETL process within a graph database project. Includes functions for reading sheets, mapping columns, normalizing role names, and exporting JSON files for roles, competencies, and relationships such as requirements and adjacency matrices.", "external_files": ["json", "pathlib.Path", "typing.Dict", "typing.List", "typing.Optional", "pandas as pd", "typer"], "external_methods": ["json.dump", "Path.open", "Path.exists", "Path.mkdir", "Path.name", "pd.read_excel", "pd.isna"], "published": ["roles_from_abbrev", "competencies_from_definitions", "requires_from_matrix", "adjacency_from_matrix"], "classes": [], "methods": [{"name": "str _canon(name: str)", "description": "Converts a string to a canonical form suitable for comparison: lowercase alphanumeric.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,str] _build_lookup(df: pd.DataFrame)", "description": "Builds a dictionary mapping canonical column names to actual DataFrame column names.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _find_col(lookup: Dict[str, str], candidates: List[str])", "description": "Finds the first matching column name based on candidate aliases.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Optional[str]] _require_mapping(df: pd.DataFrame, spec: Dict[str, List[str]], required_keys: List[str])", "description": "Resolves required column mappings based on a specification and checks for missing columns.", "scope": "", "scopeKind": ""}, {"name": "pd.DataFrame _read_excel(path: Path, sheet: Optional[str] = None)", "description": "Reads an Excel file, optionally a specific sheet.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _opt_str(val)", "description": "Returns a string for a value, or None if the value is NaN or blank.", "scope": "", "scopeKind": ""}, {"name": "Optional[float] _opt_float(val)", "description": "Converts a value to float, returning None for NaN or invalid conversions.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_out_dir(path: Path)", "description": "Creates the output directory if it doesn't exist.", "scope": "", "scopeKind": ""}, {"name": "None _write_json(path: Path, payload: List[dict])", "description": "Writes a list of dictionaries to a JSON file.", "scope": "", "scopeKind": ""}, {"name": "None _summarize(path_in: Path, path_out: Path, count: int)", "description": "Prints a message summarizing the number of records written and the output file.", "scope": "", "scopeKind": ""}, {"name": "Path _resolve_output(output_dir: Path, default_name: str)", "description": "Resolves the output file path based on directory and default filename.", "scope": "", "scopeKind": ""}, {"name": "str _norm_role_name(name: str)", "description": "Normalizes role names for matching (lowercase, alphanumeric).", "scope": "", "scopeKind": ""}, {"name": "str _abbr_fallback(name: str)", "description": "Creates a fallback role id from a name, using initials or PascalCase parts.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,str] _load_role_abbreviation_map(mapping_xlsx: Path)", "description": "Loads role abbreviation mappings from a specific sheet in an Excel workbook.", "scope": "", "scopeKind": ""}, {"name": "str _match_role_to_abbr(role_name: str, abbr_map: Dict[str, str])", "description": "Attempts to map a role name to a standard abbreviation ID via exact or heuristic match, or fallback.", "scope": "", "scopeKind": ""}, {"name": "None roles_from_abbrev( input_file: str = typer.Argument(..., help=\"Excel file containing a 'Role abbreviations' sheet.\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write roles.json\"), )", "description": "Command to convert role abbreviations sheet into roles.json.", "scope": "", "scopeKind": ""}, {"name": "None competencies_from_definitions( input_file: str = typer.Argument(..., help=\"Excel file containing a 'Competency Definitions' sheet.\"), sheet: Optional[str] = typer.Option(\"Competency Definitions\", help=\"Sheet name with competency definitions\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write competencies.json\"), )", "description": "Command to convert competency definitions sheet into competencies.json.", "scope": "", "scopeKind": ""}, {"name": "None requires_from_matrix( input_file: str = typer.Argument(..., help=\"Excel file containing a matrix sheet (default: 'Competencies and roles').\"), sheet: Optional[str] = typer.Option(\"Competencies and roles\", help=\"Sheet name with competency vs role abbreviation columns\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write requires.json\"), )", "description": "Command to convert a competency-role matrix into requires.json with relationships.", "scope": "", "scopeKind": ""}, {"name": "None adjacency_from_matrix( input_file: str = typer.Argument(..., help=\"Excel file containing a square adjacency matrix (rows/columns = roles).\"), sheet: Optional[str] = typer.Option(None, help=\"Sheet name (defaults to first sheet)\"), mapping_xlsx: Optional[str] = typer.Option( None, help=\"Optional workbook with 'Role abbreviations' to map full names to ids (e.g., Competency_mapping.xlsx)\" ), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write adjacency.json\"), use_upper_triangle_only: bool = typer.Option(True, help=\"Avoid duplicates by emitting only one direction per pair\"), )", "description": "Command to convert a square adjacency matrix of roles into adjacency.json.", "scope": "", "scopeKind": ""}, {"name": "str to_id(display_name: str)", "scope": "adjacency_from_matrix", "scopeKind": "function", "description": "unavailable"}], "calls": ["json.dump", "Path.open", "Path.mkdir", "Path.name", "pd.read_excel", "pd.isna"], "search-terms": ["xlsx_to_json", "Excel converter", "graph ETL", "roles.json", "competencies.json", "requires.json", "adjacency.json", "role abbreviations", "competency definitions", "role adjacency matrix", "role relationships"], "state": 2, "file_id": 14, "knowledge_revision": 31, "git_revision": "", "ctags": [{"_type": "tag", "name": "_abbr_fallback", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _abbr_fallback(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_build_lookup", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _build_lookup(df: pd.DataFrame) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(df: pd.DataFrame)"}, {"_type": "tag", "name": "_canon", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _canon(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_ensure_out_dir", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _ensure_out_dir(path: Path) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_find_col", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _find_col(lookup: Dict[str, str], candidates: List[str]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(lookup: Dict[str, str], candidates: List[str])"}, {"_type": "tag", "name": "_load_role_abbreviation_map", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _load_role_abbreviation_map(mapping_xlsx: Path) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(mapping_xlsx: Path)"}, {"_type": "tag", "name": "_match_role_to_abbr", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _match_role_to_abbr(role_name: str, abbr_map: Dict[str, str]) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(role_name: str, abbr_map: Dict[str, str])"}, {"_type": "tag", "name": "_norm_role_name", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _norm_role_name(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_opt_float", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _opt_float(val) -> Optional[float]:$/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "function", "signature": "(val)"}, {"_type": "tag", "name": "_opt_str", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _opt_str(val) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(val)"}, {"_type": "tag", "name": "_read_excel", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _read_excel(path: Path, sheet: Optional[str] = None) -> pd.DataFrame:$/", "language": "Python", "typeref": "typename:pd.DataFrame", "kind": "function", "signature": "(path: Path, sheet: Optional[str] = None)"}, {"_type": "tag", "name": "_require_mapping", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _require_mapping(df: pd.DataFrame, spec: Dict[str, List[str]], required_keys: List[str]) -> /", "language": "Python", "typeref": "typename:Dict[str,Optional[str]]", "kind": "function", "signature": "(df: pd.DataFrame, spec: Dict[str, List[str]], required_keys: List[str])"}, {"_type": "tag", "name": "_resolve_output", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _resolve_output(output_dir: Path, default_name: str) -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "(output_dir: Path, default_name: str)"}, {"_type": "tag", "name": "_summarize", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _summarize(path_in: Path, path_out: Path, count: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(path_in: Path, path_out: Path, count: int)"}, {"_type": "tag", "name": "_write_json", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def _write_json(path: Path, payload: List[dict]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(path: Path, payload: List[dict])"}, {"_type": "tag", "name": "adjacency_from_matrix", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def adjacency_from_matrix($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( input_file: str = typer.Argument(..., help=\"Excel file containing a square adjacency matrix (rows/columns = roles).\"), sheet: Optional[str] = typer.Option(None, help=\"Sheet name (defaults to first sheet)\"), mapping_xlsx: Optional[str] = typer.Option( None, help=\"Optional workbook with 'Role abbreviations' to map full names to ids (e.g., Competency_mapping.xlsx)\" ), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write adjacency.json\"), use_upper_triangle_only: bool = typer.Option(True, help=\"Avoid duplicates by emitting only one direction per pair\"), )"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^app = typer.Typer(add_completion=False, help=\"Excel (.xlsx\\/.xls) to normalized JSON converter f/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "competencies_from_definitions", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def competencies_from_definitions($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( input_file: str = typer.Argument(..., help=\"Excel file containing a 'Competency Definitions' sheet.\"), sheet: Optional[str] = typer.Option(\"Competency Definitions\", help=\"Sheet name with competency definitions\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write competencies.json\"), )"}, {"_type": "tag", "name": "pd", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^import pandas as pd$/", "language": "Python", "kind": "namespace", "nameref": "module:pandas"}, {"_type": "tag", "name": "requires_from_matrix", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def requires_from_matrix($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( input_file: str = typer.Argument(..., help=\"Excel file containing a matrix sheet (default: 'Competencies and roles').\"), sheet: Optional[str] = typer.Option(\"Competencies and roles\", help=\"Sheet name with competency vs role abbreviation columns\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write requires.json\"), )"}, {"_type": "tag", "name": "roles_from_abbrev", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^def roles_from_abbrev($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( input_file: str = typer.Argument(..., help=\"Excel file containing a 'Role abbreviations' sheet.\"), output_dir: str = typer.Option(\"data/processed\", help=\"Directory to write roles.json\"), )"}, {"_type": "tag", "name": "to_id", "path": "/home/kavia/workspace/code-generation/copy-of-mvp-career-platform---graph-db-214017-214037/CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "pattern": "/^    def to_id(display_name: str) -> str:$/", "file": true, "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(display_name: str)", "scope": "adjacency_from_matrix", "scopeKind": "function"}], "hash": "daf15148009b18f0897ec0e517e9fe4c", "format-version": 4, "code-base-name": "CareerPlatformBackendAPI", "filename": "CareerPlatformBackendAPI/src/etl/xlsx_to_json.py", "fields": [{"name": "app = typer.Typer(add_completion=False, help=\"Excel (.xlsx\\/.xls) to normalized JSON converter f/", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"31": ""}]}